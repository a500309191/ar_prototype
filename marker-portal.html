<!DOCTYPE html>
<html>

  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <body style="margin: 0px; overflow: hidden;">

    <script>
      // AFRAME.registerComponent("test", {
      //   init: function() {
      //     let self = this
      //     console.log("SELF: ", self)
      //   }
      // })

      AFRAME.registerComponent("model", {
        init: function() {
          let el = this.el
          console.log("EL: ", el)

          el.addEventListener("model-loaded", e => {

            let model = el.getObject3D("mesh")
            console.log("3D: ", model)

            model.traverse(node => {
              if (node instanceof THREE.Mesh) {

                console.log("node: ", node)

                switch(true) {
                  case node.name.includes("outside"):
                    const outsideMat = new THREE.MeshPhongMaterial()
                    outsideMat.color = new THREE.Color("rgb(0, 0, 255)")
                    outsideMat.side = 2
                    outsideMat.colorWrite = false
                    node.material = outsideMat
                    node.renderOrder = 1
                    outside.children.push(node)
                    break
                  case node.name.includes("inside"):
                    node.renderOrder = 2
                    inside.children.push(node)
                    break
                  default:
                    break
                }
              }
            })


          })
        }
      })
    </script>

    <!-- <a-scene test embedded arjs vr-mode-ui="enabled: false" arjs='debugUIEnabled: false;'> -->
    <a-scene embedded arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;">
      <a-marker-camera preset="hiro">

        <a-light
          intensity="4"
          color="#FFFFFF"
          light="castShadow:true; type:directional"
          position="0 5 5"
        ></a-light>

        <a-light
          intensity="5"
          color="#FFFFFF"
          light="type:ambient"
        ></a-light>



      </a-marker-camera>

        <a-entity
          camera
          look-controls
          orbit-controls="target: 0 0 0; minDistance: 0.5; maxDistance: 180; initialPosition: 0 0 0"
          model
          position="0 0 0"
          scale="0.0005 0.0005 0.0005"
          obj-model="
            obj: url(https://864427.selcdn.ru/e1c138bd4faf090bce/ar/portal.obj);
            mtl: url(https://864427.selcdn.ru/e1c138bd4faf090bce/ar/portal.mtl);
          "
        ></a-entity>
    </a-scene>

  </body>
  
</html>